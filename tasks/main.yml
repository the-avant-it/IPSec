---
- name: Update pkgs cache
  apt:
    update_cache: yes

- name: Install strongswan
  apt:
    name: strongswan

- name: copy sysconfig
  template:
    src: sysctl.conf.j2
    dest:  /etc/sysctl.d/ipsec.conf

- name: apply sys config
  shell: sysctl --system

- name: copy ipsec client conf
  template:
    src: ipsec-client.conf.j2
    dest: /etc/ipsec.conf
  delegate_to: ipsec-client

- name: copy ipsec server conf
  template:
    src: ipsec-server.conf.j2
    dest: /etc/ipsec.conf
  delegate_to: ipsec-server

- name: copy ipsec secret key
  template:
    src: ipsec-secret.j2
    dest: /etc/ipsec.secrets

- name: restart strongswan daemon
  service:
    name: strongswan-starter
    state: restarted

- name: Run ipsec connect with server
  shell: ipsec up l2tpvpn
  delegate_to: ipsec-client

